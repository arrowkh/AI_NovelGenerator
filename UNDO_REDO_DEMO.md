# 撤销/重做系统演示指南

## 视觉演示

### 1. 基本撤销/重做操作

```
初始状态：
┌─────────────────────────────────┐
│ 第1章内容：                      │
│ "很久很久以前..."               │
└─────────────────────────────────┘

用户编辑：
┌─────────────────────────────────┐
│ 第1章内容：                      │
│ "很久很久以前，有一个魔法王国..." │
└─────────────────────────────────┘

点击"保存修改"后：
操作栈：[编辑第1章]
        ↑ 最新操作

按 Ctrl+Z：
┌─────────────────────────────────┐
│ 第1章内容：                      │
│ "很久很久以前..."  ← 恢复到之前的状态
└─────────────────────────────────┘

操作栈：[]
重做栈：[编辑第1章]
        ↑ 可重做

按 Ctrl+Y：
┌─────────────────────────────────┐
│ 第1章内容：                      │
│ "很久很久以前，有一个魔法王国..." │
└─────────────────────────────────┘

操作栈：[编辑第1章]
重做栈：[]
```

### 2. 操作历史面板（Ctrl+H）

```
┌──────────────────────────────────────────────────────────┐
│ 操作历史                                    [×]           │
├──────────────────────────────────────────────────────────┤
│ 可撤销: 5 | 可重做: 0 | 分支: main                        │
│                                                           │
│ [刷新] [清空历史] [导出历史] [分支管理]                   │
├──────────────────────────────────────────────────────────┤
│                                                           │
│ 操作历史 (最近 5 条)                                      │
│ ════════════════════════════════════════════════════════ │
│                                                           │
│   5. [2025-12-18 14:30] 修改第5章内容                    │
│   4. [2025-12-18 14:29] 生成第4章 (3500字)               │
│   3. [2025-12-18 14:20] 修改项目配置                     │
│   2. [2025-12-18 14:15] 修改architecture设定             │
│   1. [2025-12-18 14:10] 生成第1章 (3200字)               │
│                                                           │
├──────────────────────────────────────────────────────────┤
│ [撤销 Ctrl+Z] [重做 Ctrl+Y] [关闭]                        │
└──────────────────────────────────────────────────────────┘
```

### 3. 分支管理面板

```
┌──────────────────────────────────────────────────────────┐
│ 时间旅行 - 分支管理                         [×]           │
├──────────────────────────────────────────────────────────┤
│ 当前分支: main                                            │
│ ════════════════════════════════════════════════════════ │
│                                                           │
│ ★ main                                                    │
│     操作数: 10                                            │
│     创建时间: 2025-12-18 14:00:00                        │
│                                                           │
│   version_a                                               │
│     操作数: 5                                             │
│     创建时间: 2025-12-18 14:25:00                        │
│     父分支: main                                          │
│                                                           │
│   version_b                                               │
│     操作数: 3                                             │
│     创建时间: 2025-12-18 14:30:00                        │
│     父分支: main                                          │
│                                                           │
├──────────────────────────────────────────────────────────┤
│ [创建分支] [切换分支] [删除分支] [关闭]                   │
└──────────────────────────────────────────────────────────┘
```

### 4. 分支结构可视化

```
时间线：
═══════════════════════════════════════════════════════════

        ╔══════╗
        ║ main ║ (主分支)
        ╚══╤═══╝
           │
    Op1 ───┤ 创建项目
           │
    Op2 ───┤ 生成小说设定
           │
    Op3 ───┤ 生成大纲
           │
    Op4 ───┼─────────────────────── 分支点
           │                          ↓
           │                    ╔════════════╗
           │                    ║ version_a  ║
           │                    ╚══╤═════════╝
           │                       │
           │                Op5a ──┤ 悲剧风格修改
           │                       │
           │                Op6a ──┤ 继续修改
           │
           │
    Op5b ──┤ 喜剧风格修改
           │
    Op6b ──┤ 生成第2章
           │
           ▼
      (当前位置)

═══════════════════════════════════════════════════════════
```

### 5. 操作合并演示

```
未合并的操作序列：
┌────────────────────────────────────────┐
│ 操作1: 修改第1章 "" → "你"            │
│ 操作2: 修改第1章 "你" → "你好"        │
│ 操作3: 修改第1章 "你好" → "你好世"    │
│ 操作4: 修改第1章 "你好世" → "你好世界" │
└────────────────────────────────────────┘
时间间隔都小于2秒 → 自动合并

合并后的操作：
┌────────────────────────────────────────┐
│ 操作1: 修改第1章 "" → "你好世界"      │
└────────────────────────────────────────┘

撤销时：
按一次 Ctrl+Z → 整个输入被撤销
```

### 6. 操作组演示

```
批量生成章节：

begin_group("批量生成章节1-5")
├─ 生成第1章 (3000字)
├─ 生成第2章 (3200字)
├─ 生成第3章 (2800字)
├─ 生成第4章 (3100字)
└─ 生成第5章 (3300字)
end_group()

在操作历史中显示为：
┌────────────────────────────────────────┐
│ 批量生成章节1-5 (5个操作)             │
└────────────────────────────────────────┘

撤销时：
按一次 Ctrl+Z → 所有5章一起被撤销
```

## 实际使用流程

### 场景：修改章节后悔了

```
步骤1：打开章节管理
[Chapters Manage] 标签页

步骤2：选择并编辑章节
选择 → 第3章
编辑内容...

步骤3：保存修改
点击 [保存修改] 按钮
✓ 操作已记录

步骤4：发现错误
"糟糕，我改错了！"

步骤5：撤销操作
按 Ctrl+Z
✓ 章节内容恢复到修改前

步骤6：如果还想恢复刚才的修改
按 Ctrl+Y
✓ 章节内容回到修改后的状态
```

### 场景：尝试两种不同的修改

```
步骤1：编辑到某个点
修改了第1-3章...

步骤2：创建分支
Ctrl+H → [分支管理] → [创建分支]
输入名称: "悲剧版本"

步骤3：在主分支上修改
继续在主分支上修改...
保存...

步骤4：切换到新分支
Ctrl+H → [分支管理] → [切换分支] → "悲剧版本"

步骤5：在新分支上修改
修改第1-3章为悲剧风格...
保存...

步骤6：对比两个版本
切换到 main → 查看效果
切换到 悲剧版本 → 查看效果

步骤7：选择喜欢的版本
决定使用悲剧版本 → 继续在悲剧版本上工作
或者决定使用主版本 → 切回main，删除悲剧版本分支
```

### 场景：查看和导出历史

```
步骤1：打开操作历史
按 Ctrl+H

步骤2：查看所有操作
滚动查看最近100条操作...

步骤3：导出历史
点击 [导出历史] 按钮
选择保存位置...
✓ 历史已导出到文件

步骤4：查看导出的文件
打开导出的 .txt 文件
可以看到完整的操作历史记录
```

## 快捷键速查表

```
╔══════════════════════════════════════════════════════════╗
║                   快捷键速查表                            ║
╠══════════════════════════════════════════════════════════╣
║                                                           ║
║  Ctrl+Z          撤销上一个操作                          ║
║  Ctrl+Y          重做被撤销的操作                        ║
║  Ctrl+Shift+Z    重做（备选）                            ║
║  Ctrl+H          打开操作历史面板                        ║
║                                                           ║
╚══════════════════════════════════════════════════════════╝
```

## 菜单导航

```
应用程序主窗口
│
└─ 菜单栏
   │
   └─ 编辑
      ├─ 撤销 (Ctrl+Z)
      ├─ 重做 (Ctrl+Y)
      └─ 操作历史 (Ctrl+H)
         │
         └─ 操作历史面板
            ├─ 操作列表
            ├─ 撤销/重做按钮
            ├─ 导出历史
            ├─ 清空历史
            └─ 分支管理
               ├─ 创建分支
               ├─ 切换分支
               └─ 删除分支
```

## 状态指示

### 可撤销状态
```
┌──────────────────┐
│ 撤销 (Ctrl+Z)    │  ← 按钮正常显示
└──────────────────┘
提示：当前有 5 个可撤销的操作
```

### 不可撤销状态
```
┌──────────────────┐
│ 撤销 (Ctrl+Z)    │  ← 按钮灰色显示
└──────────────────┘
提示：没有可撤销的操作
```

### 可重做状态
```
┌──────────────────┐
│ 重做 (Ctrl+Y)    │  ← 按钮正常显示
└──────────────────┘
提示：当前有 2 个可重做的操作
```

### 不可重做状态
```
┌──────────────────┐
│ 重做 (Ctrl+Y)    │  ← 按钮灰色显示
└──────────────────┘
提示：没有可重做的操作
```

## 提示和技巧

### 💡 技巧1：保存前可以随时撤销
```
在文本编辑器中编辑时：
Ctrl+Z → 编辑器自己的撤销功能

保存后：
Ctrl+Z → 撤销整个保存操作
```

### 💡 技巧2：创建分支前的时机
```
好时机：
✓ 重大修改前
✓ 不确定方向时
✓ 想尝试不同风格时

不好时机：
✗ 每次小修改都创建分支（太多分支难以管理）
```

### 💡 技巧3：定期导出历史
```
建议：
每完成一个章节 → 导出历史
完成一天的工作 → 导出历史
重大修改后 → 导出历史

这样即使历史文件损坏，也有备份
```

### 💡 技巧4：分支命名
```
好的命名：
✓ "version_tragedy"（悲剧版本）
✓ "experiment_new_ending"（实验新结局）
✓ "style_formal"（正式风格）

不好的命名：
✗ "test1"
✗ "branch1"
✗ "temp"
```

### 💡 技巧5：使用操作组
```
对于批量操作，使用操作组：

例如批量生成10章：
begin_group("批量生成1-10章")
  → 生成各章...
end_group()

这样撤销时一次就能撤销所有10章
```

## 常见图标说明

```
★  当前分支
◆  操作已记录
✓  操作成功
✗  操作失败
⚠  警告
ℹ  信息
```

## 视觉状态图

### 操作状态流转

```
[新建操作]
    ↓
[记录中...]
    ↓
[已记录] ← 当前可以撤销
    ↓
[按Ctrl+Z]
    ↓
[已撤销] ← 当前可以重做
    ↓
[按Ctrl+Y]
    ↓
[已重做] ← 回到"已记录"状态
```

### 分支状态图

```
[主分支: main]
    ↓ 创建分支
[分支列表] ← 显示所有分支
    ↓ 选择分支
[切换分支?] ← 确认对话框
    ↓ 确认
[切换完成] ← 当前在新分支上
```

## 演示总结

撤销/重做系统提供了：
- 🔄 简单直观的撤销/重做操作
- 📜 完整的操作历史记录
- 🌳 灵活的分支管理
- 💾 自动持久化保存
- ⚡ 高效的性能优化

让你的小说创作过程更加安全、高效、无忧！
